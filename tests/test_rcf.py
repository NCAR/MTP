###############################################################################
# Test util/rcf.py
#
# This test uses CSET RCF file NRCKA068.RCF as a test input file.
#
# To run these tests:
#     cd src/
#     python3 -m unittest discover -s ../tests -v
#
# To increase debugging info uncomment this line:
# import faulthandler; faulthandler.enable()
# and then run these tests with the -Xfaulthandler option, e.g.
#
# python3 -Xfaulthandler -m unittest discover -s ../tests -v
#
# Written in Python 3
#
# COPYRIGHT:   University Corporation for Atmospheric Research, 2019
###############################################################################
import os
import unittest
from util.rcf import RetrievalCoefficientFile


class TESTrcf(unittest.TestCase):

    def setUp(self):
        self.filename = "../tests/test_data/NRCKA068.RCF"
        # Constants the apply specifically to the CSET RCF file above
        self.flightLevelsKm = [13.0, 12.0, 9.5, 8.0, 6.0, 5.0, 3.5, 2.5, 2.0,
                               1.5, 1.0, 0.5, 0.0]
        self.numFlightLevels = 13

        # Instantiate an RCF reader
        self.rcf = RetrievalCoefficientFile(self.filename)
        self.RCFHdr = self.rcf.getRCF_HDR()  # Get a pointer to the header dict
        self.RCFFl = self.rcf.getFL_RC_Vec()

    def testRCFId(self):
        # Test that the RCF Id is accurately parsed from the filename
        self.assertEqual(self.rcf.getId(), "NRCKA068")

    def testOpen(self):
        self.assertTrue(self.filename, "../tests/test_data/NRCKA068.RCF")
        self.assertTrue(os.path.exists(self.filename))

    def testBadOpen(self):
        # Test initialization with a bogus directory
        self.rcf = RetrievalCoefficientFile("../")

    def testHeader(self):
        self.assertEqual(self.RCFHdr['RAOBcount'], 189)
        self.assertEqual(self.RCFHdr['NFL'], self.numFlightLevels)
        self.assertEqual(self.RCFHdr['SURC'], 'CAN1')
        self.assertEqual(self.RCFHdr['Zr'][0:self.numFlightLevels],
                         self.flightLevelsKm[0:self.numFlightLevels])

    def testPALT(self):
        # Test pressure altitudes at each flight level
        PALT = ['165.10', '193.30', '285.23', '355.99', '471.81', '540.19',
                '657.64', '746.82', '794.95', '845.55', '898.74', '954.60',
                '1013.24']
        for i in range(self.RCFHdr['NFL']):
            self.assertEqual('%.2f' % self.RCFFl[i]['sBP'], PALT[i])

    def testGetRCAvgWtLow(self):
        # Test flight level above range in RCF file
        PAltKm = 15
        RcSetAvWt = self.rcf.getRCAvgWt(PAltKm)

        # Weighted average observable should be observable closest to PAltKm,
        # so self._RCFFl[0]
        self.assertEqual('%.2f' % RcSetAvWt['sBP'], '165.10')

    def testGetRCAvgWtHigh(self):
        # Test flight level below range in RCF file
        PAltKm = -1
        RcSetAvWt = self.rcf.getRCAvgWt(PAltKm)

        # Weighted average observable should be observable closest to PAltKm,
        # so self._RCFFl[self._RCFHdr['NFL']-]
        self.assertEqual('%.2f' % RcSetAvWt['sBP'], '1013.24')

    def testGetRCAvgWt(self):
        # Set a flight level to calculate at for testing purposes.
        # PAltKm is the pressure alititude of the aircraft in KM from the
        # iwg packet
        PAltKm = 5.3473
        RcSetAvWt = self.rcf.getRCAvgWt(PAltKm)

        self.assertEqual('%.2f' % RcSetAvWt['sBP'], '516.44')

        sOBrms = ['0.23', '0.18', '0.19', '0.21', '0.21', '0.19', '0.20',
                  '0.19', '0.18', '0.20', '0.21', '0.22', '0.23', '0.27',
                  '0.28', '0.23', '0.23', '0.21', '0.19', '0.19', '0.22',
                  '0.25', '0.23', '0.24', '0.23', '0.20', '0.18', '0.19',
                  '0.19', '0.19']
        for i in range(self.rcf.NUM_BRT_TEMPS):
            self.assertEqual('%.2f' % RcSetAvWt['sOBrms'][i], sOBrms[i])

        sOBav = ['260.873', '262.086', '263.148', '264.821', '266.223',
                 '267.633', '269.080', '270.545', '272.247', '274.390',
                 '263.284', '264.028', '264.689', '265.756', '266.667',
                 '267.633', '268.625', '269.582', '270.720', '272.192',
                 '264.002', '264.608', '265.152', '266.039', '266.798',
                 '267.633', '268.493', '269.297', '270.264', '271.528']
        for i in range(self.rcf.NUM_BRT_TEMPS):
            self.assertEqual('%.3f' % RcSetAvWt['sOBav'][i], sOBav[i])

        sBPrl = ['1013.250', '1013.250', '1013.250', '977.287', '862.694',
                 '781.622', '715.848', '671.671', '637.946', '613.558',
                 '589.932', '567.053', '552.198', '537.666', '526.966',
                 '516.442', '506.087', '495.909', '482.583', '469.556',
                 '450.552', '432.170', '414.401', '391.634', '364.617',
                 '329.338', '292.465', '243.486', '186.420', '133.866',
                 '91.687', '56.239', '32.511']
        for i in range(self.rcf.NUM_RETR_LVLS):
            self.assertEqual('%.3f' % RcSetAvWt['sBPrl'][i], sBPrl[i])

        sRTav = ['300.682', '300.682', '300.682', '300.927', '300.247',
                 '296.526', '290.416', '285.707', '281.926', '279.092',
                 '276.296', '273.560', '271.821', '270.097', '268.851',
                 '267.638', '266.437', '265.273', '263.776', '262.309',
                 '260.150', '258.007', '255.839', '252.840', '249.032',
                 '243.476', '236.965', '227.197', '215.428', '207.657',
                 '206.992', '213.791', '219.739']
        for i in range(self.rcf.NUM_RETR_LVLS):
            self.assertEqual('%.3f' % RcSetAvWt['sRTav'][i], sRTav[i])

        sRMSa = ['64.4150', '64.4150', '64.4150', '52.2102', '17.3824',
                 '2.4614', '1.5134', '1.3043', '1.2376', '1.1901', '1.1867',
                 '1.2185', '1.2077', '1.2113', '1.2225', '1.2323', '1.2515',
                 '1.2575', '1.2450', '1.2130', '1.1994', '1.1501', '1.1067',
                 '1.0640', '1.1362', '1.2121', '1.2724', '1.2520', '1.5042',
                 '1.7074', '1.6775', '1.3334', '1.0866']
        for i in range(self.rcf.NUM_RETR_LVLS):
            self.assertEqual('%.4f' % RcSetAvWt['sRMSa'][i], sRMSa[i])

        sRMSe = ['60.8125', '60.8125', '60.8125', '48.7604', '15.9138',
                 '1.9609', '0.9335', '0.6767', '0.5203', '0.4080', '0.3487',
                 '0.2986', '0.2154', '0.1846', '0.1319', '0.0891', '0.1586',
                 '0.2200', '0.3174', '0.3679', '0.4701', '0.5755', '0.6658',
                 '0.7285', '0.8416', '0.9630', '1.0381', '1.1176', '1.3936',
                 '1.6023', '1.5821', '1.2593', '1.0444']
        for i in range(self.rcf.NUM_RETR_LVLS):
            self.assertEqual('%.4f' % RcSetAvWt['sRMSe'][i], sRMSe[i])

        self.assertEqual(len(RcSetAvWt['Src']), 990)

        RCwt = ['-2.93269', '-3.39398', '-0.83616', '0.61555', '1.57267',
                '4.27800', '1.71693', '-12.47249', '-15.71872', '60.75449',
                '-0.81487', '0.20774', '0.63355', '0.78408', '1.49153',
                '2.91939',
                '4.51264', '-2.91759', '-15.28144', '-13.67004', '-0.05103',
                '0.19265', '0.43220', '0.85231', '2.63211', '3.86089',
                '7.61448', '-1.16573', '-11.06506', '-17.12912', '-2.93269',
                '-3.39398', '-0.83616', '0.61555', '1.57267', '4.27800',
                '1.71693', '-12.47249', '-15.71872', '60.75449', '-0.81487',
                '0.20774', '0.63355', '0.78408', '1.49153', '2.91939',
                '4.51264', '-2.91759', '-15.28144', '-13.67004', '-0.05103',
                '0.19265', '0.43220', '0.85231', '2.63211', '3.86089',
                '7.61448', '-1.16573', '-11.06506', '-17.12912', '-2.93269',
                '-3.39398', '-0.83616', '0.61555', '1.57267', '4.27800',
                '1.71693', '-12.47249', '-15.71872', '60.75449', '-0.81487',
                '0.20774', '0.63355', '0.78408', '1.49153', '2.91939',
                '4.51264', '-2.91759', '-15.28144', '-13.67004', '-0.05103',
                '0.19265', '0.43220', '0.85231', '2.63211', '3.86089',
                '7.61448', '-1.16573', '-11.06506', '-17.12912', '-2.36534',
                '-2.83438', '-0.66725', '0.45436', '1.71219', '5.08328',
                '0.29378', '-11.78539', '-12.99878', '56.41427', '-0.77567',
                '0.12762', '0.57129', '0.79527', '1.74326', '3.46893',
                '2.94999', '-3.54518', '-14.19748', '-11.32801', '-0.01485',
                '0.12099', '0.34325', '0.98956', '3.05560', '4.58766',
                '4.97616', '-2.38522', '-10.80188', '-15.24875', '-0.48418',
                '-0.63848', '-0.12427', '-0.02937', '0.54509', '2.34892',
                '-0.24967', '-4.66843', '-4.44395', '22.42276', '-0.22694',
                '-0.01777', '0.07395', '0.17926', '0.70775', '1.60295',
                '0.80433', '-1.62588', '-5.55361', '-3.86921', '-0.04964',
                '-0.08479', '-0.05473', '0.25569', '1.27372', '2.11990',
                '1.36627', '-1.25732', '-4.37102', '-5.69524', '0.00915',
                '0.01003', '0.00976', '-0.04487', '0.03177', '0.26420',
                '-0.16317', '-0.85155', '-0.20271', '4.12792', '-0.01347',
                '-0.02301', '-0.03003', '-0.01246', '0.07333', '0.18030',
                '0.08551', '-0.40880', '-0.89735', '-0.15344', '-0.03507',
                '-0.03836', '-0.03702', '-0.00550', '0.13190', '0.23844',
                '0.18603', '-0.31807', '-0.80566', '-0.64610', '-0.04977',
                '-0.05002', '-0.02153', '0.00485', '0.03614', '0.07248',
                '-0.27044', '-0.41577', '0.37502', '2.23823', '-0.02110',
                '-0.01023', '-0.00133', '0.00975', '0.03515', '0.04946',
                '-0.08838', '-0.34424', '-0.37481', '0.34217', '-0.01619',
                '-0.00624', '0.01040', '0.01846', '0.05552', '0.06541',
                '-0.10820', '-0.35320', '-0.43842', '-0.04343', '-0.05916',
                '-0.05135', '-0.01730', '0.01231', '0.01118', '0.04850',
                '-0.27577', '-0.25665', '0.50129', '1.53873', '-0.01251',
                '-0.00097', '0.00654', '0.00739', '0.00641', '0.03310',
                '-0.11639', '-0.29939', '-0.19548', '0.44670', '-0.00230',
                '0.00409', '0.01716', '0.00875', '0.00854', '0.04377',
                '-0.14146', '-0.33300', '-0.30198', '0.12547', '-0.03571',
                '-0.03659', '-0.01542', '0.00705', '0.01042', '0.03279',
                '-0.28040', '-0.13711', '0.55278', '1.14355', '-0.01223',
                '-0.00413', '0.00355', '0.00700', '0.00340', '0.02238',
                '-0.14854', '-0.25906', '-0.07078', '0.48673', '-0.00523',
                '0.00144', '0.01068', '0.00949', '0.00318', '0.02960',
                '-0.19784', '-0.31557', '-0.19658', '0.22524', '-0.00940',
                '-0.01599', '-0.01080', '0.00061', '0.01400', '0.01625',
                '-0.27281', '-0.03915', '0.54888', '0.85227', '-0.00949',
                '-0.00671', '-0.00243', '0.00633', '0.00481', '0.01109',
                '-0.16633', '-0.21513', '0.02292', '0.48180', '-0.00619',
                '-0.00178', '0.00315', '0.01055', '0.00486', '0.01467',
                '-0.22730', '-0.29023', '-0.10990', '0.27833', '0.00958',
                '0.00598', '-0.00015', '0.00162', '0.00142', '-0.02558',
                '-0.23681', '0.09396', '0.51276', '0.49814', '0.00044',
                '-0.00022', '-0.00086', '0.00304', '-0.00408', '-0.01746',
                '-0.18538', '-0.13243', '0.14586', '0.45273', '0.00100',
                '0.00087', '0.00078', '0.00458', '-0.00813', '-0.02309',
                '-0.27681', '-0.22468', '0.01937', '0.33172', '0.00590',

                # These are the lines 12-32 that still need to be formatted.
                # I am assuming that if the first 11 lines match, the rest
                # will (-:
                # '-6.20999e-05','-0.00643025','0.00239517','0.0122997',
                # '-0.0868224',
                # '-0.131165','0.202276','0.40353','0.186229','-0.00413666',
                # '-0.00300272','-0.000232624','0.00652658','0.0040562',
                # '-0.0592493',
                # '-0.155617','-0.0123738','0.23209','0.359262','-0.00204515',
                # '-0.000397341','0.00228887','0.00914018','0.00428458',
                # '-0.0783572',
                # '-0.260629','-0.0929515','0.144223','0.321424','-0.00578296',
                # '-0.0014442','0.00386626','0.00527329','-0.0100144',
                # '-0.10903',
                # '0.0374165','0.217207','0.209908','0.00960081','0.00373856',
                # '0.0058624','0.00611589','-0.000717962','-0.0123513',
                # '-0.074404',
                # '-0.0535891','0.109187','0.221318','0.190557','0.00714233',
                # '0.00605964','0.00453023','-0.00559074','-0.0221158',
                # '-0.0983994',
                # '-0.129304','0.0829971','0.201629','0.215091','-0.00839322',
                # '0.000890772','0.00993663','0.00713783','-0.027795',
                # '-0.12276',
                # '0.183883','0.177724','0.0401964','-0.099935','0.00952489',
                # '0.0108893','0.00851428','-0.00612855','-0.027105',
                # '-0.0837737',
                # '0.0831315','0.183918','0.164192','0.0405989','0.0104686',
                # '0.00781778','0.00387205','-0.0148753','-0.0465844',
                # '-0.110791',
                # '0.0886754','0.218706','0.197619','0.0979666','-0.00409518',
                # '-0.00152083','0.00128106','-0.000312175','-0.0123546',
                # '0.00910464',
                # '0.176335','0.0823727','-0.0223757','-0.0727038','0.00110826',
                # '0.00107638','0.000294325','-0.00445259','-0.0101245',
                # '0.00621318',
                # '0.144285','0.13029','0.0687725','-0.0179869','0.00160412',
                # '-0.000165614','-0.00180424','-0.0075204','-0.0165893',
                # '0.00821693',
                # '0.231267','0.181935','0.104011','0.0185469','-0.00191653',
                # '-0.0103112','-0.01156','0.00120382','0.0534366','0.21986',
                # '0.0467396','-0.00151433','-0.0164749','-0.00441615',
                # '-0.0100964',
                # '-0.00716505','-0.00126936','0.0168602','0.0493414',
                # '0.150037',
                # '0.0609781','0.021053','-0.00357318','-0.0142189',
                # '-0.00824146',
                # '-0.00233747','0.00560977','0.0317008','0.0838801','0.198423',
                # '0.115983','0.0392527','0.0051666','-0.0117636','-0.0432767',
                # '-0.0574818','-0.0275434','0.0615502','0.219848','0.0805759',
                # '-0.0141306','-0.0143947','-0.00971926','0.0032599',
                # '-0.0191864',
                # '0.00805742','0.041885','0.0957267','0.152957','0.0549866',
                # '-0.00650583','-0.013153','-0.0138854','-0.00871286',
                # '0.00496413',
                # '0.0288278','0.0739602','0.149599','0.233582','0.0727198',
                # '-0.00761725','-0.0168865','-0.0152056','-0.0111633',
                # '-0.103543',
                # '-0.0760091','0.0250216','0.175526','0.23208','-0.0974063',
                # '-0.024848','0.00525001','0.0171563','-0.0148077','0.0325166',
                # '0.0894337','0.135258','0.14667','0.0894914','-0.066472',
                # '-0.0293967','-0.0115479','0.00714558','0.0155925',
                # '0.0881666',
                # '0.109851','0.172041','0.186856','0.100982','-0.0879092',
                # '-0.0549801','-0.0204759','-2.41059e-05','0.0122219',
                # '-0.0689164',
                # '0.0493072','0.177','0.250525','0.0347883','-0.172486',
                # '-0.0146963','0.01012','0.0255381','0.0165764','0.157489',
                # '0.204374','0.208411','0.0978597','-0.0782748','-0.117708',
                # '-0.0272662','-0.00272884','0.00984176','0.0203904',
                # '0.204853',
                # '0.180113','0.204272','0.0703865','-0.157563','-0.155669',
                # '-0.0555914','-0.00974195','0.005572','0.0188382','0.075463',
                # '0.248125','0.296856','0.200729','-0.140258','-0.146128',
                # '-0.00216647','0.00130259','0.00732045','0.00942736',
                # '0.24876',
                # ,'0.235209','0.181974','0.00247057','-0.148816','-0.0997204',
                # ,'-0.0137759','0.00228926','0.00254195','0.00417546',
                # '0.239835',
                # ,'0.16378','0.129561','-0.062635','-0.236549','-0.13188',
                # ,'-0.0286153','0.00109134','0.00205814','0.00667988',
                # '0.402635',
                # '0.592215','0.420669','0.028138','-0.33266','-0.0787596',
                # '0.0278501','0.0307528','-0.00321597','-0.0505484','0.332752',
                # '0.193375','0.0552844','-0.143476','-0.186049','-0.0537471',
                # '0.0059333','0.031147','0.0269159','-0.00503609','0.207088',
                # '0.0640632','-0.0496542','-0.233351','-0.262199','-0.0710806',
                # '-0.00118912','0.0324824','0.0346203','0.00805216','0.679508',
                # '0.828793','0.438805','-0.158816','-0.362531','0.0186187',
                # '0.0402834','0.01131','-0.0123417','-0.0290679','0.321871',
                # '0.087233','-0.097178','-0.221899','-0.141943','0.0127058',
                # '0.0377751','0.0223899','0.00426833','-0.0156871','0.0994666',
                # '-0.0636533','-0.213128','-0.291185','-0.171304','0.0168034',
                # '0.062163','0.0365805','0.0157278','-0.0113382','0.833322',
                # '0.902159','0.377701','-0.261097','-0.291948','0.111041',
                # '0.0065406','-0.0268147','-0.0183888','0.0157307','0.255853',
                # '-0.0142219','-0.191803','-0.222897','-0.0722818','0.0757768',
                # '0.0361272','-0.0177946','-0.0243256','-0.0153433',
                # '-0.00508406',
                # '-0.150111','-0.285215','-0.255971','-0.0589127','0.100215',
                # '0.0827469','-0.00375065','-0.0254485','-0.0232141',
                # '0.945803',
                # '0.904913','0.282853','-0.310815','-0.192007','0.17659',
                # '-0.0292846','-0.0381416','-0.0231619','-0.0176226','0.15484',
                # '-0.10857','-0.247973','-0.190596','-0.0124733','0.120508',
                # '0.0164083','-0.0351843','-0.0283002','-0.0113894',
                # '-0.110663',
                # '-0.208914','-0.306198','-0.190429','0.0293473','0.159372',
                # '0.0485847','-0.038047','-0.0372244','-0.0158127','1.06344',
                # '0.946068','0.236635','-0.353311','-0.156058','0.149347',
                # '-0.0152723','-0.0120902','-0.018212','-0.0773014','0.111204',
                # '-0.1591','-0.282493','-0.182261','0.0133528','0.101917',
                # '0.00959745','-0.0110659','-0.0018304','-0.00124638',
                # '-0.168508',
                # '-0.240418','-0.325142','-0.171504','0.0603751','0.134785',
                # '0.0291526','-0.012147','-0.00869045','-0.000180021',
                # '1.10196',
                # '0.950444','0.215317','-0.344744','-0.168674','0.141101',
                # '-0.0337356','0.00239277','0.000852792','-0.120508',
                # '0.0917729',
                # '-0.166865','-0.278956','-0.183328','0.00327378','0.0962898',
                # '-0.019938','-0.0110674','0.0197335','0.0197927','-0.182552',
                # '-0.237462','-0.318778','-0.177539','0.0421645','0.127343',
                # '-0.019552','-0.0195903','0.00709692','0.0274294','1.11402',
                # '0.955072','0.216278','-0.340705','-0.209727','0.211153',
                # '-0.0646229','-0.0106762','0.0182923','-0.0470204','0.098876',
                # '-0.158537','-0.273375','-0.194722','-0.0314903','0.144095',
                # '-0.036819','-0.0386604','0.00572759','0.0394902','-0.173093',
                # '-0.228852','-0.318297','-0.199935','-0.0123973','0.190566',
                # '-0.0357423','-0.0628277','-0.0158638','0.0311013','0.913412',
                # '0.772669','0.166191','-0.293021','-0.22608','0.263542',
                # '-0.0304754','-0.0331269','-0.0409431','-0.0554899',
                # '0.0738864',
                # '-0.139221','-0.233909','-0.185129','-0.0587199','0.179846',
                # '-0.00159423','-0.0271552','-0.0236015','-0.0111469',
                # '-0.143708',
                # '-0.193286','-0.276725','-0.205242','-0.0527911','0.237846',
                # '0.0343671','-0.0358533','-0.0275366','-0.00928271',
                # '0.00689488',
                # '-0.0498113','-0.0708261','-0.0492742','-0.0248591','0.13862',
                # '-0.0289184','0.0879891','-0.00142512','-0.664011',
                # '-0.0598576',
                # '-0.0584041','-0.041789','-0.0294916','0.0100913','0.0945968',
                # '-0.0372896','0.0255018','0.0993267','-0.0115212',
                # '-0.0413022',
                # '-0.0339826','-0.0401684','-0.0191128','0.0287765','0.125104',
                # '-0.05','-0.0121598','0.0760756','0.0680038','-0.819695',
                # '-0.723092','-0.169229','0.254524','0.173578','-0.0720302',
                # '0.0236468','-0.0670527','-0.0368798','0.0689076',
                # '-0.0870399',
                # '0.104618','0.201938','0.157032','0.0132744','-0.0491548',
                # '0.0401629','-0.0202313','-0.0712484','-0.0590264','0.116814',
                # '0.171875','0.246636','0.170105','-0.0156258','-0.0650073',
                # '0.0883008','-0.00300827','-0.0625012','-0.0707731',
                # '-0.53647',
                # '-0.465917','-0.135986','0.165725','0.124074','-0.0615034',
                # '0.0278692','0.0497474','-0.0408202','-0.364819','-0.0623935',
                # '0.0738212','0.134606','0.112187','0.00779065','-0.0419711',
                # '-0.0314586','0.0355472','0.055626','-0.0434283','0.0718409',
                # '0.109562','0.16337','0.109967','-0.026166','-0.0555068',
                # '-0.0753953','0.0343862','0.0659259','0.0127487','-0.0693109',
                # '-0.0998527','-0.0609777','-0.012542','0.0721365','-0.085172',
                # '0.0667241','0.179968','-0.0718341','-0.698117','-0.0479168',
                # '-0.0425231','-0.0157436','0.0313314','0.0492592',
                # '-0.0581231',
                # '-0.0270044','0.119063','0.167248','-0.0731189','-0.0243885',
                # '-0.0147345','0.00601545','0.0448257','0.0758941',
                # '-0.0768678',
                # '-0.0901862','0.0977766','0.172422','0.0498532','-0.161697',
                # '-0.128592','-0.0258219','0.069847','0.0602271','-0.0467906',
                # '-0.0533634','0.031524','0.034','-0.212532','-0.001219',
                # '0.0333178','0.0444852','0.0447727','0.0186279','-0.0319308',
                # '-0.0637043','-0.0181832','0.0419992','0.0290648','0.0260516',
                # '0.0432534','0.0581722','0.046218','0.0106163','-0.0422285',
                # '-0.129636','-0.0395568','0.0300431','0.0403545',
                ]
        # Uncomment this when done formatting above lines
        # for j in range(self.rcf.NUM_RETR_LVLS)
        for j in range(11):
            for i in range(self.rcf.NUM_BRT_TEMPS):
                self.assertEqual('%.5f' % RcSetAvWt['Src'][j *
                                 self.rcf.NUM_BRT_TEMPS + i],
                                 RCwt[j * self.rcf.NUM_BRT_TEMPS + i])
